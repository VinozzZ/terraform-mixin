
schemaVersion: 1.0.0
name: basic-tf-example
version: 0.2.0
registry: ghcr.io/getporter

parameters:
  - name: tfstate
    type: file
    path: /cnab/app/terraform/terraform.tfstate
    source:
      output: tfstate
  - name: myvar
    type: string
    default: "porter rocks!"

outputs:
  - name: tfstate
    type: file
    path: /cnab/app/terraform/terraform.tfstate
  - name: myvar
    type: string
    applyTo:
      - install
      - upgrade
mixins:
  - terraform:
      clientVersion: 1.0.0

install:
  - terraform:
      description: "Install Terraform assets"
      vars:
        myvar: ${bundle.parameters.myvar}
      outputs:
        - name: myvar

upgrade:
  - terraform:
      description: "Upgrade Terraform assets"
      vars:
        myvar: ${bundle.parameters.myvar}
      outputs:
        - name: myvar

show:
  - terraform:
      description: "Invoke 'terraform show'"

plan:
  - terraform:
      description: "Invoke 'terraform plan'"
      flags:
        no-color:
        out: "/dev/null"
        var:
          - "'myvar=${bundle.parameters.myvar}'"

# Note: this can't be 'version:' as this would conflict with top-level field
# Hence the need for the 'arguments:' override
printVersion:
  - terraform:
      description: "Invoke 'terraform version'"
      arguments: 
        - "version"

uninstall:
  - terraform:
      description: "Uninstall Terraform assets"

